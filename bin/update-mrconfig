#!/usr/bin/env sh
#
# Refresh mrconfig with active repos
# After running, may wish to execute:
#   - ./bin/setup-team-repo (to pull any new repos)
#   - ./bin/archive-team-repo (to remove any old repos)
#
# Usage: ./bin/update-mrconfig
# There are no arguments
#

set -e

export LC_ALL=C

## https://gitlab.com/kalilinux/packages
projects=$(salsa --conf-file /dev/null --api-url https://gitlab.com/api/v4/ --group-id 5034987 ls | awk '/Name:/ {print $2}' | sort)

cat <<EOF> mrconfig
[DEFAULT]
jobs = 4
# Ignore svn/cvs metadata
svn_test = false
cvs_test = false
EOF

for project in ${projects}; do
  cat <<EOF>> mrconfig

[${project}]
checkout = gbp clone --debian-branch=kali/master git@gitlab.com:kalilinux/packages/${project}.git
EOF
done
