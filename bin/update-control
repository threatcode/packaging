#!/bin/sh

set -e

source=$(basename $PWD)

updated=false

if grep -q -E "Maintainer: .*(kali|offensive-security|hertzog|sophie@freexian)" debian/control; then
    sed -i -e "s|^Maintainer: .*|Maintainer: Kali Developers <devel@kali.org>|i" debian/control
else
    sed -i -e "s|^Maintainer: \(.*\)|XSBC-Original-Maintainer: \1\nMaintainer: Kali Developers <devel@kali.org>|i" debian/control
fi

if ! git diff --quiet; then
    git commit -q -a -m "Update Maintainer field"
    updated=true
fi

sed -i \
 -e "s|^Vcs-Git: .*|Vcs-Git: https://gitlab.com/kalilinux/packages/$source.git|i" \
 -e "s|^Vcs-Browser: .*|Vcs-Browser: https://gitlab.com/kalilinux/packages/$source|i" \
 debian/control

if ! git diff --quiet; then
    git commit -q -a -m "Update Vcs-* fields for the move to gitlab.com"
    updated=true
fi

if ! git diff --quiet origin/kali/master..HEAD; then
    git push -q
fi
